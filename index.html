<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pride Welfare Society App</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Manifest for PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1e40af">
  <!-- iOS Support -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
</head>
<body class="bg-gray-100 font-sans">
  <div class="container mx-auto p-4">
    <h1 class="text-2xl font-bold text-center text-blue-800 mb-4">Pride Welfare Society</h1>
    
    <!-- Member Management -->
    <div class="bg-white p-4 rounded shadow mb-4">
      <h2 class="text-xl font-semibold mb-2">Add Member</h2>
      <div class="space-y-2">
        <input id="flatNo" type="text" placeholder="Flat Number" class="w-full p-2 border rounded">
        <input id="memberName" type="text" placeholder="Member Name" class="w-full p-2 border rounded">
        <input id="contact" type="text" placeholder="Contact Number" class="w-full p-2 border rounded">
        <button onclick="addMember()" class="bg-blue-500 text-white p-2 rounded w-full">Add</button>
      </div>
      <h3 class="text-lg font-semibold mt-4">Member List</h3>
      <ul id="memberList" class="list-disc pl-5"></ul>
      <button id="editMemberBtn" onclick="showEditForm()" class="bg-yellow-500 text-white p-2 rounded mt-2 w-full hidden">Edit Selected Member</button>
    </div>

    <!-- Edit Member Form -->
    <div id="editForm" class="bg-white p-4 rounded shadow mb-4 hidden">
      <h2 class="text-xl font-semibold mb-2">Edit Member</h2>
      <div class="space-y-2">
        <input id="editFlatNo" type="text" placeholder="Flat Number" class="w-full p-2 border rounded" disabled>
        <input id="editMemberName" type="text" placeholder="Member Name" class="w-full p-2 border rounded">
        <input id="editContact" type="text" placeholder="Contact Number" class="w-full p-2 border rounded">
        <button onclick="saveEdit()" class="bg-green-500 text-white p-2 rounded w-full">Save Changes</button>
        <button onclick="cancelEdit()" class="bg-red-500 text-white p-2 rounded mt-2 w-full">Cancel</button>
      </div>
    </div>

    <!-- Maintenance Tracking -->
    <div class="bg-white p-4 rounded shadow mb-4">
      <h2 class="text-xl font-semibold mb-2">Maintenance Tracking</h2>
      <div class="space-y-2">
        <input id="paymentFlatNo" type="text" placeholder="Flat Number" class="w-full p-2 border rounded">
        <input id="paymentAmount" type="number" placeholder="Amount" class="w-full p-2 border rounded">
        <input id="paymentDate" type="date" class="w-full p-2 border rounded">
        <button onclick="addPayment()" class="bg-blue-500 text-white p-2 rounded w-full">Add Payment</button>
      </div>
      <h3 class="text-lg font-semibold mt-4">Payment History</h3>
      <ul id="paymentList" class="list-disc pl-5"></ul>
    </div>

    <!-- Treasurer Dashboard -->
    <div class="bg-white p-4 rounded shadow">
      <h2 class="text-xl font-semibold mb-2">Treasurer Dashboard</h2>
      <p>Total Income: ₹<span id="totalIncome">0</span></p>
      <p>Total Due: ₹<span id="totalDue">0</span></p>
    </div>
  </div>

  <script>
    let members = JSON.parse(localStorage.getItem('members')) || [];
    let payments = JSON.parse(localStorage.getItem('payments')) || [];
    let selectedMemberIndex = -1;

    function addMember() {
      const flatNo = document.getElementById('flatNo').value;
      const name = document.getElementById('memberName').value;
      const contact = document.getElementById('contact').value;
      if (flatNo && name) {
        members.push({ flatNo, name, contact });
        localStorage.setItem('members', JSON.stringify(members));
        updateMemberList();
        document.getElementById('flatNo').value = '';
        document.getElementById('memberName').value = '';
        document.getElementById('contact').value = '';
      }
    }

    function updateMemberList() {
      const memberList = document.getElementById('memberList');
      memberList.innerHTML = '';
      members.forEach((member, index) => {
        const li = document.createElement('li');
        li.textContent = `Flat ${member.flatNo}: ${member.name} (${member.contact})`;
        li.onclick = () => selectMember(index); // Click to select member
        memberList.appendChild(li);
      });
      document.getElementById('editMemberBtn').classList.toggle('hidden', members.length === 0);
    }

    function selectMember(index) {
      selectedMemberIndex = index;
      const member = members[index];
      document.getElementById('editFlatNo').value = member.flatNo;
      document.getElementById('editMemberName').value = member.name;
      document.getElementById('editContact').value = member.contact;
      document.getElementById('editForm').classList.remove('hidden');
    }

    function showEditForm() {
      if (selectedMemberIndex >= 0) {
        document.getElementById('editForm').classList.remove('hidden');
      }
    }

    function saveEdit() {
      if (selectedMemberIndex >= 0) {
        const newName = document.getElementById('editMemberName').value;
        const newContact = document.getElementById('editContact').value;
        members[selectedMemberIndex].name = newName;
        members[selectedMemberIndex].contact = newContact;
        localStorage.setItem('members', JSON.stringify(members));
        updateMemberList();
        cancelEdit();
      }
    }

    function cancelEdit() {
      selectedMemberIndex = -1;
      document.getElementById('editForm').classList.add('hidden');
      document.getElementById('editFlatNo').value = '';
      document.getElementById('editMemberName').value = '';
      document.getElementById('editContact').value = '';
    }

    function addPayment() {
      const flatNo = document.getElementById('paymentFlatNo').value;
      const amount = document.getElementById('paymentAmount').value;
      const date = document.getElementById('paymentDate').value;
      if (flatNo && amount && date) {
        payments.push({ flatNo, amount: Number(amount), date });
        localStorage.setItem('payments', JSON.stringify(payments));
        updatePaymentList();
        updateDashboard();
        document.getElementById('paymentFlatNo').value = '';
        document.getElementById('paymentAmount').value = '';
        document.getElementById('paymentDate').value = '';
      }
    }

    function updatePaymentList() {
      const paymentList = document.getElementById('paymentList');
      paymentList.innerHTML = '';
      payments.forEach(payment => {
        const li = document.createElement('li');
        li.textContent = `Flat ${payment.flatNo}: ₹${payment.amount} (${payment.date})`;
        paymentList.appendChild(li);
      });
    }

    function updateDashboard() {
      const totalIncome = payments.reduce((sum, p) => sum + p.amount, 0);
      document.getElementById('totalIncome').textContent = totalIncome;
      const expectedPerFlat = 1000; // Adjust as needed
      const totalDue = members.length * expectedPerFlat - totalIncome;
      document.getElementById('totalDue').textContent = totalDue > 0 ? totalDue : 0;
    }

    // Initialize
    updateMemberList();
    updatePaymentList();
    updateDashboard();

    // Service Worker for PWA
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>
</body>
</html>